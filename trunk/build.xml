<?xml version="1.0"?> 

<!--
This is an ant build file compatible with ant version 1.3.

Useful targets:
    + jars jar  the default target to make jar files
    + dist      creates a crimson-[version].zip file
    + clean     deletes all generated files

All generated files are created under ${build.dir}

As of (2001-08-13), the build requires a sibling xml-commons module to be a
peer of this module.
-->

<project name="crimson" default="jars" basedir=".">

  <!-- Use this property to set version of crimson -->
  <property name="impl.version" value="1.1.2beta2" />
  <property name="name" value="crimson"/>

  <!-- Build options -->
  <property name="optimize" value="false" />
  <property name="debug" value="on" />

  <!-- The name "build" refers to a directory without a version number,
       while the name "dist" refers to a directory with a version number
       that can be zipped or tarred.  Unzipping such a zip file will create
       a directory neatly containing everything in the distribution.  -->

  <property name="build.dir" value="build" />
  <property name="build.classes" value="${build.dir}/classes"/>

  <property name="dist.file" value="${name}-${impl.version}" />
  <property name="dist.dir" value="${build.dir}/${dist.file}"/>

  <!-- Points to tree containing common XML APIs shared between various
       Apache XML projects.  The base directory contains the build.xml file
       used to build the common api jar file. -->
  <property name="api.base.dir" value="../xml-commons/java/external"/>
  <property name="api.build.dir" value="${api.base.dir}/build"/>
  <property name="api.jar.name" value="xml-apis.jar"/>
<!-- XXX This task does not work with Ant 1.3 for some unknown reason
  <available file="${api.base.dir}/build.xml" property="api.base.dir.present"/>
-->

  <target name="prepare" >
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${build.classes}"/>
  </target>

  <!-- ==================== Build  ==================== -->

  <target name="compile" depends="prepare">
    <javac srcdir="src" 
           destdir="${build.classes}"
           debug="${debug}"
           optimize="${optimize}"
           deprecation="off" >
      <classpath>
        <pathelement location="${build.classes}" />
        <pathelement location="${build.dir}/${api.jar.name}" />
        <pathelement location="src" />
      </classpath>
      <exclude name="**/,**" />
      <exclude name="**/SCCS/**" />
      <include name="org/apache/**" />
    </javac>
    <copy 
      todir="${build.classes}/org/apache" >
      <fileset dir="src/org/apache" >
        <include name="**/**.properties" />
        <exclude name="**/,**" />
        <exclude name="**/SCCS/**" />
      </fileset>
    </copy>
  </target>

  <target name="api.base.dir" unless="api.base.dir.present">
    <echo message="The xml-commons module must be a sibling of this one."/>
  </target>

  <target name="api.jar" depends="api.base.dir">
    <ant dir="${api.base.dir}" target="jar"/>
    <copy file="${api.build.dir}/${api.jar.name}" todir="${build.dir}" />
  </target>

  <target name="crimson.jar" depends="api.jar,compile">
    <mkdir dir="${build.classes}/META-INF/services" />
    <copy todir="${build.classes}/META-INF/services">
      <fileset dir="src/META-INF/services">
        <include name="javax.xml.parsers.SAXParserFactory" />
        <include name="javax.xml.parsers.DocumentBuilderFactory" />
      </fileset>
    </copy>
    <jar jarfile="${build.dir}/crimson.jar"
         basedir="${build.classes}"
         manifest="src/META-INF/manifest.crimson" >
      <include name="META-INF/services/**" />
      <include name="org/apache/crimson/**" />
    </jar>
  </target>

  <target name="javadoc" depends="api.base.dir">
    <ant dir="${api.base.dir}" target="javadoc">
    </ant>
    <mkdir dir="${build.dir}/docs/javadoc"/>
    <copy todir="${build.dir}/docs/javadoc">
      <fileset dir="${api.build.dir}/docs/javadoc">
      </fileset>
    </copy>
  </target>

  <target name="other.doc">
    <copy file="docs/README.txt" todir="${dist.dir}" />
    <copy file="ChangeLog" todir="${dist.dir}" />
  </target>

  <target name="dist" depends="jars,javadoc,other.doc,api.base.dir" >
    <!-- Copy the jar files -->
    <copy file="${build.dir}/${name}.jar" todir="${dist.dir}" />
    <copy file="${build.dir}/${api.jar.name}" todir="${dist.dir}" />

    <!-- Copy sources -->
    <copy todir="${dist.dir}/src">
      <!-- Parser implementation src files -->
      <fileset dir="src"/>

      <!-- XML API src files -->
      <fileset dir="${api.base.dir}/src"/>
    </copy>

    <!-- Copy built documentation and javadoc -->
    <copy todir="${dist.dir}/docs">
      <fileset dir="${build.dir}/docs"/>
    </copy>

    <!-- Copy examples -->
    <copy todir="${dist.dir}/examples">
      <fileset dir="examples"/>
    </copy>

    <zip zipfile="${build.dir}/${dist.file}.zip"
         basedir="${build.dir}"
         includes="${dist.file}/**" />
  </target>

  <target name="jars" depends="api.jar,crimson.jar">
  </target>

  <target name="jar" depends="jars">
  </target>

  <target name="all" depends="jars">
  </target>

  <target name="main" depends="prepare,all,dist">
  </target>

  <target name="clean">
    <delete dir="${build.dir}"/>
    <ant dir="${api.base.dir}" target="clean"/>
  </target>
  
</project>
